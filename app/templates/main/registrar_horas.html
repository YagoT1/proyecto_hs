    {% extends "base.html" %}

    {% block title %}Registrar Horas{% endblock %}

    {% block content %}
    <div class="bg-gray-800 p-10 rounded-xl shadow-2xl text-center border border-gray-700 max-w-3xl mx-auto">
        <h1 class="text-4xl font-bold mb-6 text-white">Registrar Horas Extra</h1>
        <p class="text-lg mb-8 text-gray-300">Ingresa tus horas extra trabajadas y genera reportes.</p>

        <form method="POST" id="registroForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <div id="registros_container" class="space-y-6 mb-8">
                {# Inicialmente, un campo de registro vacío #}
                <div class="registro-item bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 relative">
                    <button type="button" class="remove-registro absolute top-3 right-3 text-red-400 hover:text-red-600 focus:outline-none" style="display:none;">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                    <div class="mb-4 text-left">
                        <label for="fecha_0" class="block text-gray-300 text-sm font-bold mb-2">Fecha:</label>
                        <input type="date" id="fecha_0" name="fecha_0" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-900 text-white" required>
                    </div>
                    <div class="mb-4 text-left">
                        <label for="horas_0" class="block text-gray-300 text-sm font-bold mb-2">Horas:</label>
                        {# Cambiado a type="text" para permitir coma decimal #}
                        <input type="text" id="horas_0" name="horas_0" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-900 text-white" placeholder="Ej: 8,5 o 15" required>
                    </div>
                    <div class="mb-4 text-left">
                        <label for="obs_0" class="block text-gray-300 text-sm font-bold mb-2">Observación (opcional):</label>
                        <textarea id="obs_0" name="obs_0" rows="3" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-900 text-white" placeholder="Detalles adicionales sobre las horas..."></textarea>
                    </div>
                    <div class="mb-4 text-left flex items-center">
                        <input type="checkbox" id="feriado_0" name="feriado_0" class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="feriado_0" class="text-gray-300 text-sm font-bold">Es Feriado / Domingo (100%)</label>
                    </div>
                </div>
            </div>

            <button type="button" id="add_registro" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-md mb-6">
                Añadir Otro Registro
            </button>

            <div class="flex flex-wrap justify-center gap-4">
                <button type="submit" name="action" value="save_records" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
                    Guardar Registros
                </button>
                <button type="submit" name="action" value="generate_pdf" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
                    Generar PDF
                </button>
                <a href="{{ url_for('main.index') }}" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-full transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
                    Cancelar
                </a>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let registroIndex = 0; // Para el primer registro, que ya está en el HTML
            const container = document.getElementById('registros_container');
            const addRegistroBtn = document.getElementById('add_registro');
            const form = document.getElementById('registroForm');

            // Función para actualizar la visibilidad de los botones de eliminar
            function updateRemoveButtonsVisibility() {
                const removeButtons = document.querySelectorAll('.remove-registro');
                if (removeButtons.length > 1) {
                    removeButtons.forEach(btn => btn.style.display = 'block');
                } else {
                    removeButtons.forEach(btn => btn.style.display = 'none');
                }
            }

            // Mostrar/ocultar el botón de eliminar para el registro inicial
            updateRemoveButtonsVisibility();

            addRegistroBtn.addEventListener('click', function() {
                registroIndex++;
                const newRegistroHtml = `
                    <div class="registro-item bg-gray-700 p-6 rounded-lg shadow-md border border-gray-600 relative">
                        <button type="button" class="remove-registro absolute top-3 right-3 text-red-400 hover:text-red-600 focus:outline-none">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                        <div class="mb-4 text-left">
                            <label for="fecha_${registroIndex}" class="block text-gray-300 text-sm font-bold mb-2">Fecha:</label>
                            <input type="date" id="fecha_${registroIndex}" name="fecha_${registroIndex}" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-900 text-white" required>
                        </div>
                        <div class="mb-4 text-left">
                            <label for="horas_${registroIndex}" class="block text-gray-300 text-sm font-bold mb-2">Horas:</label>
                            {# Cambiado a type="text" para permitir coma decimal #}
                            <input type="text" id="horas_${registroIndex}" name="horas_${registroIndex}" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-900 text-white" placeholder="Ej: 8,5 o 15" required>
                        </div>
                        <div class="mb-4 text-left">
                            <label for="obs_${registroIndex}" class="block text-gray-300 text-sm font-bold mb-2">Observación (opcional):</label>
                            <textarea id="obs_${registroIndex}" name="obs_${registroIndex}" rows="3" class="shadow appearance-none border border-gray-600 rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline bg-gray-900 text-white" placeholder="Detalles adicionales sobre las horas..."></textarea>
                        </div>
                        <div class="mb-4 text-left flex items-center">
                            <input type="checkbox" id="feriado_${registroIndex}" name="feriado_${registroIndex}" class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="feriado_${registroIndex}" class="text-gray-300 text-sm font-bold">Es Feriado / Domingo (100%)</label>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', newRegistroHtml);
                updateRemoveButtonsVisibility();
            });

            // Delegación de eventos para los botones de eliminar
            container.addEventListener('click', function(event) {
                if (event.target.closest('.remove-registro')) {
                    const itemToRemove = event.target.closest('.registro-item');
                    if (itemToRemove) {
                        itemToRemove.remove();
                        updateRemoveButtonsVisibility();
                    }
                }
            });

            // Script para reemplazar comas por puntos antes de enviar el formulario
            form.addEventListener('submit', function(event) {
                const horasInputs = form.querySelectorAll('input[name^="horas_"]');
                horasInputs.forEach(input => {
                    input.value = input.value.replace(',', '.');
                });
            });
        });
    </script>
    {% endblock %}
